\usepackage{xspace}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{MnSymbol}
\usepackage{stmaryrd}
\usepackage[inline]{enumitem}
\setlist{itemsep=0pt}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{ulem}
\renewcommand{\ULdepth}{.7pt}
\normalem
\usepackage{comment}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\algrenewcommand{\algorithmicfor}{{\bfseries\sffamily for}}
\algrenewcommand{\algorithmicif}{{\bfseries\sffamily if}}
\algrenewcommand{\algorithmicelse}{{\bfseries\sffamily else}}
\algrenewcommand{\algorithmicthen}{{\bfseries\sffamily then}}
\algrenewcommand{\algorithmicdo}{{\bfseries\sffamily do}}
\usepackage{multicol}

\newcommand{\GROOVE}{GROOVE}

% Closure of a pseudo-state
\newcommand{\cls}[1]{\gotomax{#1}}
%\newcommand{\cls}[1]{{#1}{\triangleright}}
% Prime of a pseudo-state
\newcommand{\prm}[1]{\gotomin{#1}}
%\newcommand{\prm}[1]{{\triangleleft}\mkern-2mu{#1}}
% Equivalence relation generated from \goto
\newcommand{\stat}[1]{[{#1}]}

\newcommand{\dom}{\mathop{\mathrm{dom}}}
\newcommand{\True}{\mathbf{true}}
\newcommand{\False}{\mathbf{false}}

% Adding a pseudo-state to a configuration
\newcommand{\addp}[2]{{#1}{\cdot}{#2}}

% Inner and outer
\newcommand{\kInner}{innr}
\newcommand{\Inner}[1][\,]{\ensuremath{\mathit{\kInner}_{\!#1}}\xspace}
\newcommand{\pInner}{\mbox{\textit{\uline{\kInner}}}\xspace}
\newcommand{\kOuter}{outr}
\newcommand{\Outer}[1][\,]{\ensuremath{\mathit{\kOuter}_{\!#1}}\xspace}
\newcommand{\pOuter}{\mbox{\uline{$\mathit{\kOuter}$}}\xspace}

\newcommand{\Init}[1][\,]{\ensuremath{\iota}_{\!#1}\xspace}
\newcommand{\pInit}{\mbox{\uline{$\iota$}}\xspace}

\newcommand{\pPrime}{\mbox{\textit{\uline{prim}}}\xspace}

\newcommand{\kFull}{full}
\newcommand{\Full}[1][\mkern2mu]{\ensuremath{\mathit{\kFull}}_{\mkern-2mu#1}\xspace}
\newcommand{\pFull}{\mbox{\uline{\textit{\kFull}}}\xspace}
\newcommand{\kShort}{shrt}
\newcommand{\Short}[1][]{\ensuremath{\mathit{\kShort}}_{\mkern-2mu#1}\xspace}
\newcommand{\pShort}{\mbox{\uline{\textit{\kShort}}}\xspace}

% Open and closed
\newcommand{\Open}[1][\,]{\ensuremath{\mathit{open}}_{\!#1}\xspace}
\newcommand{\Closed}[1][]{\ensuremath{\mathit{clsd}_{#1}}\xspace}
\newcommand{\pClosed}{\mbox{\uline{\textit{clsd}}}\xspace}
\newcommand{\pOpen}{\mbox{\uline{\textit{open}}}\xspace}

% Absent and presend
\newcommand{\kAbsent}{abst}
\newcommand{\Absent}[1][]{\ensuremath{\mathit{\kAbsent}}_{#1}\xspace}
\newcommand{\pAbsent}{\mbox{\uline{\textit{\kAbsent}}}\xspace}
\newcommand{\kPresent}{prst}
\newcommand{\Present}[1][\,]{\ensuremath{\mathit{\kPresent}}_{\!#1}\xspace}
\newcommand{\pPresent}{\mbox{\uline{\textit{\kPresent}}}\xspace}

% Steady and transient
\newcommand{\kSteady}{stdy}
\newcommand{\Steady}[1][\mkern1mu]{\ensuremath{\mathit{\kSteady}}_{\mkern-1mu#1}\xspace}
\newcommand{\pSteady}{\mbox{\textit{\uline{\kSteady}}}\xspace}
\newcommand{\kTransient}{trnt}
\newcommand{\Transient}[1][\,]{\ensuremath{\mathit{\kTransient}}_{\!#1}\xspace}
\newcommand{\pTransient}{\mbox{\textit{\uline{\kTransient}}}\xspace}

% Fertile and barren
\newcommand{\kFertile}{frtl}
\newcommand{\pFertile}{\mbox{\textit{\uline{\kFertile}}}\xspace}
\newcommand{\kBarren}{brrn}
\newcommand{\pBarren}{\mbox{\textit{\uline{\kBarren}}}\xspace}

% Transience level
\newcommand{\TLevel}[1][]{\ensuremath{\tau}_{#1}\xspace}
\newcommand{\pTLevel}{\mbox{\uline{$\tau$}}\xspace}

% Absence level
\newcommand{\ALevel}[1][]{\ensuremath{\alpha}_{#1}\xspace}
\newcommand{\pALevel}{\mbox{\uline{$\alpha$}}\xspace}

% Outer level
\newcommand{\OLevel}[1][\,]{\ensuremath{o}_{\!#1}\xspace}
% Recipe mapping
\newcommand{\Recipe}[1][\,]{\ensuremath{\rho}_{\!#1}\xspace}

% Partiality of a transition
\newcommand{\Partial}[1][]{\ensuremath{\mathit{part}}_{\!#1}\xspace}
\newcommand{\Atomic}[1][]{\ensuremath{\mathit{atom}}_{\!#1}\xspace}

% Past outer pseudo-states
\newcommand{\BackOut}[1][\mkern2mu]{\cB^{\smash{\kOuter\!}}_{\smash{\mkern-2mu#1}}}
% Reachable outer pseudo-states
\newcommand{\ForwOut}[1][\mkern2mu]{\cF^{\smash{\kOuter\!}}_{\smash{\!#1}}}
% Past inner pseudo-states
\newcommand{\BackIn}[1][\mkern2mu]{\cB^{\smash{\kInner\!}}_{\smash{\mkern-2mu#1}}}
% Reachable inner pseudo-states
\newcommand{\ForwIn}[1][\mkern2mu]{\cF^{\smash{\kInner\!}}_{\smash{\!#1}}}
% Past transient pseudo-states
\newcommand{\BackTrans}[1][]{\cB^{\smash{\kTransient}}_{\smash{\mkern-2mu#1}}}
% Reachable transient pseudo-states
\newcommand{\ForwTrans}[1][\mkern2mu]{\cF^{\kTransient}_{\smash{\!#1}}}
% Reachable transient open pseudo-states
\newcommand{\ForwTrOp}[1][\mkern2mu]{\cF^{\mathit{trop}}_{\smash{\!#1}}}

% Outgoing transitions
\newcommand{\OutTrans}[1][\mkern2mu]{T_{\smash{#1}}}


\newcommand{\cC}{\mathcal{C}}
\newcommand{\cP}{\mathcal{P}}
\newcommand{\cB}{\mathcal{B}}
\newcommand{\cF}{\mathcal{F}}
\newcommand{\cS}{\mathcal{S}}

\newcommand{\natN}{\mathbb{N}}
\newcommand{\boolB}{\mathbb{B}}

\newcommand{\setof}[1]{\{{#1}\}}
\newcommand{\gensetof}[2]{\setof{{#1}\mid{#2}}}
\newcommand{\tupof}[1]{\langle{#1}\rangle}
\newcommand{\iffdef}{:\Leftrightarrow}
% Partial function
\newcommand{\pto}{\hookrightarrow}
% Such that
\newcommand{\st}{.\,}

% Special arrows

\newcommand{\gostep}[1][]{\mathrel{{\prec}\mkern-5mu{\cdot}}_{#1}}
\newcommand{\ngostep}[1][]{\not\goeststep[1]}
%\newcommand{\goto}[1][]{\prec_{#1}}
\newcommand{\gotoeq}[1][]{\preccurlyeq_{#1}}
\newcommand{\evolequiv}{\smilefrown}
\newcommand{\gotomax}{\curlyvee}
\newcommand{\biggotomax}{\bigcurlyvee}
\newcommand{\gotomin}{\curlywedge}
\newcommand{\biggotomin}{\bigcurlywedge}

\newcommand{\comestep}[1][]{\mathrel{{\cdot}\mkern-5mu{\succ}}_{#1}}
\newcommand{\ncomestep}[1][]{\not\comesfromstep[1]}
%\newcommand{\comefrom}[1][]{\succ_{#1}}
\newcommand{\comefromeq}[1][]{\succcurlyeq_{#1}}

\newcommand{\sqsubsetdot}{\mathrel{{\sqsubset}\mkern-11mu}{\cdot}\mkern2mu}
%\newcommand{\innerstep}{\leadsto}
%\newcommand{\innerstep}[1][]{\mapstochar\xrightarrow{\smash{\xxlabel{\!\Inner\!}}}_{\!#1}}
\newcommand{\innerstep}[1][]{\mathrel{\sqsubsetdot_{#1}^{\smash{\mkern-1mu\kInner\!}}}}
%\newcommand{\innerto}[1][]{\mathrel{\goto[#1]^{\smash{\mkern-1mu\Inner\!}}}}
\newcommand{\innerto}[1][]{\mathrel{\sqsubset_{#1}^{\smash{\mkern-1mu\kInner\!}}}}
\newcommand{\innertoeq}[1][]{\mathrel{\sqsubseteq_{#1}^{\smash{\mkern-1mu\kInner\!}}}}

\newcommand{\absentstep}[1][]{\mathrel{\sqsubsetdot_{#1}^{\smash{\mkern-1mu\kAbsent\!}}}}
%\newcommand{\absentto}[1][]{\mathrel{\goto[#1]^{\smash{\mkern-1mu\Absent\!}}}}
\newcommand{\absenttoeq}[1][]{\mathrel{\sqsubseteq_{#1}^{\smash{\mkern-1mu\kAbsent\!}}}}

\newcommand{\transientstep}[1][]{\mathrel{\sqsubsetdot_{#1}^{\smash{\mkern-1mu\kTransient\!}}}}
%\newcommand{\shortto}[1][]{\mathrel{\goto[#1]^{\smash{\mkern-1mu\Short\!}}}}
\newcommand{\transienttoeq}[1][]{\mathrel{\sqsubseteq_{#1}^{\smash{\mkern-1mu\kTransient\!}}}}

\newcommand{\final}{{\uparrow}}
\newcommand{\pfinal}{{\upmapsto}}

% Typeset the label of an extensible arrow by lowering the text
\newcommand{\xlabel}[1]{\smash{\mathchoice
		{\raisebox{-1.5pt}{$\scriptstyle#1$}}
		{\raisebox{-1.5pt}{$\scriptstyle#1$}}
		{\raisebox{-1pt}{$\scriptstyle#1$}}
		{\raisebox{-1pt}{$\scriptscriptstyle#1$}}
}}
% Typeset the label of an extensible arrow by lowering the text further
\newcommand{\xxlabel}[1]{\smash{\mathchoice
		{\raisebox{-3pt}{$\scriptstyle#1$}}
		{\raisebox{-3pt}{$\scriptstyle#1$}}
		{\raisebox{-2pt}{$\scriptstyle#1$}}
		{\raisebox{-2pt}{$\scriptscriptstyle#1$}}
}}
% Prepend a negation to an extensible arrow
\newcommand{\xarrownot}{\mathrel{\arrownot-}\mkern-7mu}

% single-arrow transition
\newcommand{\trans}[2][\,]{\xrightarrow{\xlabel{#2}}_{\!#1}}
% negative single-arrow transition
\newcommand{\ntrans}[2][\,]{\mathrel{\xarrownot\trans{#2}}_{\!#1}}

% mapsto-like transition
\newcommand{\step}[2][\,]{\mapstochar\xrightarrow{\xlabel{#2}}_{\!#1}}
% negated mapsto-like transition
\newcommand{\nstep}[2][\,]{\mapstochar\joinrel\xarrownot\xrightarrow{\xlabel{#2}}_{\!#1}}
% step with unspecified label
\newcommand{\stepany}[1][\,]{\mapsto_{\!#1}}
% negated step with unspecified label
\newcommand{\nstepany}[1][\,]{\mathrel{\!\arrownot\,\mapsto_{\!#1}}}

% Transactional transition
\newcommand{\tstep}[2][\,]{\mapstochar\xrightarrow{\xlabel{#2}}\mathrel{\mkern-13mu}\rightarrow_{\!#1}}
% Negated transactional transition
%\newcommand{\nttrans}{\arrownot\tstep}

%%%% Recapture the mapstochar, which is set to undefined by MnSymbol
\usepackage{trimclip}

\makeatletter
\providecommand{\mapstochar}{\mathrel{\mathpalette\mapstochar@\relax}}
\newcommand{\mapstochar@}[2]{%
	\makebox[0pt][l]{%
		\clipbox{0 0 {0.8\width} 0}{$\m@th#1\mapsto$}%
	}%
}
\makeatother
